<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartSales365 - E-commerce Inteligente</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="E-commerce inteligente con IA, NLP y Machine Learning. Compra con comandos de voz y predicciones personalizadas." />
    <meta name="theme-color" content="#4f46e5" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="SmartSales365" />
    
    <!-- Icons -->
    <link rel="apple-touch-icon" href="/icon-192x192.png" />
    <link rel="icon" type="image/png" sizes="144x144" href="/icon-144x144.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512x512.png" />
    
    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- SOLUCIÓN DEFINITIVA: Deshabilitar display de errores 403 falsos -->
    <script>
      // EJECUTAR ANTES QUE TODO - Sobrescribir console completamente
      (function() {
        'use strict';
        
        // Guardar referencias originales
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        const originalInfo = console.info;
        
        // Función para detectar error 403 falso
        function isFake403Error(arg) {
          if (!arg) return false;
          
          // Caso 1: Objeto con propiedades del error
          if (typeof arg === 'object' && arg.code === 403 && 
              arg.httpStatus === 200 && arg.httpError === false) {
            return true;
          }
          
          // Caso 2: String que menciona el error
          const str = typeof arg === 'string' ? arg : JSON.stringify(arg);
          if (str.includes('"code":403') && 
              str.includes('"httpStatus":200') &&
              str.includes('"httpError":false')) {
            return true;
          }
          
          return false;
        }
        
        // Sobrescribir console.error COMPLETAMENTE
        console.error = function(...args) {
          // Filtrar CUALQUIER argumento que sea el error 403 falso
          if (args.some(isFake403Error)) {
            console.warn('⚠️ [FILTRADO] Error 403 falso suprimido - Backend OK');
            return; // NO mostrar nada
          }
          originalError.apply(console, args);
        };
        
        // Sobrescribir console.log por si el error se muestra ahí
        console.log = function(...args) {
          if (args.some(isFake403Error)) return;
          originalLog.apply(console, args);
        };
        
        // Handler de promesas rechazadas - DEBE estar ANTES de cargar scripts
        window.addEventListener('unhandledrejection', function(event) {
          if (isFake403Error(event.reason)) {
            console.warn('⚠️ [SUPRIMIDO] Promesa rechazada con error 403 falso');
            event.preventDefault();
            event.stopImmediatePropagation();
            return false;
          }
        }, true); // useCapture = true para ejecutar primero
        
        // Handler de errores globales
        window.addEventListener('error', function(event) {
          if (isFake403Error(event.error)) {
            console.warn('⚠️ [SUPRIMIDO] Error global 403 falso');
            event.preventDefault();
            event.stopImmediatePropagation();
            return false;
          }
        }, true);
        
        // OPCIÓN NUCLEAR: Si aún aparece, deshabilitar TODOS los logs de "Uncaught"
        const originalOnError = window.onerror;
        window.onerror = function(message, source, lineno, colno, error) {
          // Filtrar mensajes que contengan "Uncaught (in promise)" con el error
          if (typeof message === 'string' && message.includes('Uncaught')) {
            if (isFake403Error(error)) {
              console.warn('⚠️ [SUPRIMIDO] window.onerror - Error 403 falso');
              return true; // Suprimir error
            }
          }
          
          if (originalOnError) {
            return originalOnError(message, source, lineno, colno, error);
          }
          return false;
        };
        
        console.warn('✅ Sistema de supresión de errores 403 falsos activado');
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
